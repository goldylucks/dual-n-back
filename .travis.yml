language: node_js
node_js:
- node
sudo: true
dist: trusty
env:
  global:
  # GITHUB_TOKEN (deploy to github pages)
  - secure: SGmI2gSHYSL7iM9KIWYsOdZ3iS0KpVxXsJsTaobEvvY6n0tpDM6BVlatrDSggQjX/YT4V6vz14Fv3SXLaL/eZGQ3K0gOK7NMv7kkg4pEkLwVMjUe4DvSyLOp2GDDfQR3SKXy/+5iRHIX+gLf2QJMlK2T92cyftt3DgnBiZPke7LUa9roMP1jPaWacRwgu3TNEmd7wQ7sdf8QZNWhQDxIUQNjnQDrdXyta6ist4smzK3BNCdJh8NpsxK9gdi2Y3tvRlvfYAE70kkadIPwc/pZpZPxMaX2U3Ac4z7Dgjbv3gCGNt9kKZ4iBnRAzZ+gaQAkYV1v7AURT2Ccm2sPGD0yQX5ZUAqI+wWrjZdK52j6rI01A+0WsYxZYO5k+dGVUkBbPXJE93WFmaA1YDZ6G0ijojanMINwYKiPVfipZPe/aeD1/uxUFLRjx4n3aEe3GmJRkcbU6maX5dk7hVD+XLLQ7dUuBOdcrOuJNYtDXmbUeLFzHZLMOVc8fzyhrbKgVujgSTXn7X+Xn51fANUBKlbbTSJ7xWday7w/Ni3tuPm92HZTT3/Nnuc4uIiLHVIRJjZQ/9MYltDRn4uzcPBXzyYM+daMiD3b3Sza9PbDfdnyGr2bg6xNR0GOeV5YoSjOa+Kkc2EszNs5s6t9CjVki+h/G4ljAq5sep8fFhRusPJ/15w=
branches:
  only:
  - master
  - "/v\\d\\./"
  - /^greenkeeper-.*$/
matrix:
  - env: SCRIPT=lint
  - env: SCRIPT=test
  - env: E2Eweb=true
before_install:  
 - export CHROME_BIN=/usr/bin/google-chrome
 - export DISPLAY=:99.0
 - sh -e /etc/init.d/xvfb start
 - sudo apt-get update
 - sudo apt-get install -y libappindicator1 fonts-liberation
 - wget https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb
 - sudo dpkg -i google-chrome*.deb
cache:
  directories:
  - node_modules
script:
- if [ "$SCRIPT" ]; then npm run $SCRIPT; fi
- if [ "$E2Eweb" ]; then ./scripts/e2e-web-travis.sh; fi
after_success:
  - ./scripts/deployToGhPagesCi.sh

deploy:
  - provider: heroku
    app: memory-n-back-staging
    api_key:
      secure: wNJJocSbMBYdAZ/RAkdsSxRgoXtgpuSFy8XZIbYOkbCeg1L9h3b4uLHKF0OSq3wPyjgkVKL0/ASAXxcFkE4rDpM1kJhxPTSbywLqm4k/KgbON1DAZwdAJDzHR1LOfzJyRcSWxE/eafcFgmvpHyzTjXeWlm/ibpy7jsXuTlqDhPxN3A0iQAMTBvMCTJUeEPf5ybpsjirpbfUDXMS3TtyGs1T83hraOESW+8Ogxg//+CdT1ILoYrqv4E5ywKegHE5iLg+UbIZiJzoexYspZVOqJbtuA8Xdpse9R4qgL1GdEP9H+92FfqHhANqIeYWn1hzIJLZ77RekVClCbsR5aSDr+RL0nu3OUEuORrXmGYrb7vmqGGPCGdJ0rxgCJW/+sk/TVzsG/7tGoWgMWrt6bWeuV1cIw2Pv0b0pTw5jxomGn/nupkdWj0AOVsmWGYo4YyE/ilO/reRszZEY375XmNrV30KVN2iP2rdK0JmylZMevLhk0CerJwiGMygdBqgEaB6qdQZ12pWT45qdmd2xiVSlVCrAFAXBkdqGu3SpHdGsRv4mXSeXrKyV6BrK/nd83czXE+zXTwRBD/vv9WWTP2v6OMUY0FSRiKVcOAB1xMCejWRHNCy8ljuTEPGFNbuTnXUG4vwAZ1+gkORJVM4v3TIeBkM7C2kx6lCMzEoow86KyTY=
  - provider: heroku
    app: memory-n-back
    api_key:
      secure: wNJJocSbMBYdAZ/RAkdsSxRgoXtgpuSFy8XZIbYOkbCeg1L9h3b4uLHKF0OSq3wPyjgkVKL0/ASAXxcFkE4rDpM1kJhxPTSbywLqm4k/KgbON1DAZwdAJDzHR1LOfzJyRcSWxE/eafcFgmvpHyzTjXeWlm/ibpy7jsXuTlqDhPxN3A0iQAMTBvMCTJUeEPf5ybpsjirpbfUDXMS3TtyGs1T83hraOESW+8Ogxg//+CdT1ILoYrqv4E5ywKegHE5iLg+UbIZiJzoexYspZVOqJbtuA8Xdpse9R4qgL1GdEP9H+92FfqHhANqIeYWn1hzIJLZ77RekVClCbsR5aSDr+RL0nu3OUEuORrXmGYrb7vmqGGPCGdJ0rxgCJW/+sk/TVzsG/7tGoWgMWrt6bWeuV1cIw2Pv0b0pTw5jxomGn/nupkdWj0AOVsmWGYo4YyE/ilO/reRszZEY375XmNrV30KVN2iP2rdK0JmylZMevLhk0CerJwiGMygdBqgEaB6qdQZ12pWT45qdmd2xiVSlVCrAFAXBkdqGu3SpHdGsRv4mXSeXrKyV6BrK/nd83czXE+zXTwRBD/vv9WWTP2v6OMUY0FSRiKVcOAB1xMCejWRHNCy8ljuTEPGFNbuTnXUG4vwAZ1+gkORJVM4v3TIeBkM7C2kx6lCMzEoow86KyTY=
    on:
      tags: true
      all_branches: true # needed due to travis limitation, we deploy only on master
