language: node_js
node_js:
- node
sudo: false
env:
  global:
  # GITHUB_TOKEN (deploy to github pages)
branches:
  only:
  - master
  - "/v\\d\\./"
matrix:
  include:
  - env: SCRIPT=lint
  - env: SCRIPT=test
  - env: E2Eweb=true

cache:
  directories:
  - node_modules
script:
- if [ "$SCRIPT" ]; then npm run $SCRIPT; fi
- if [ "$E2Eweb" ]; then npm run start:e2e & sleep 30 && npm run e2e:web; fi
after_success:
  - ./scripts/deployToGhPagesCi.sh
